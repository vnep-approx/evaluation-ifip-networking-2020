#!/usr/bin/env bash

help=$'Plots all implemented figures of a given reduced results pickle file, generated by an experiment.
The ALIB_EXPERIMENT_HOME environment variable needs to be set.

Usage: ./plot_all_from_vm_RELATIVE.sh <<folder_name>> <<numerator_reduced_results_pickle>> <<denominator_reduced_results_pickle>>
Example: ./plot_all_from_vm_RELATIVE.sh arbitrary_fixed_relative/plots arbitrary-routing/arbitrary-synthetic_result_reduced.pickle fixed-routing/fixed-synthetic_result_reduced.pickle'

folder_name=$1
numerator_reduced_results_pickle=$2
denominator_reduced_results_pickle=$3

if [[ "$@" == *'-h'* ]] || [[ "$@" == *'--help' ]]; then
    echo "${help}";
    exit 0;
fi;

numerator_pickle="$(basename ${numerator_reduced_results_pickle})"
denominator_pickle="$(basename ${denominator_reduced_results_pickle})"
cp ${numerator_reduced_results_pickle} ${ALIB_EXPERIMENT_HOME}/input/${numerator_pickle};
cp ${denominator_reduced_results_pickle} ${ALIB_EXPERIMENT_HOME}/input/${denominator_pickle};

mkdir -p ${folder_name}

for p in total_runtime best_fractional_cost best_integer_cost max_edge_load \
          max_node_load preprocess_runtime optimization_runtime postprocess_runtime relative_cost;
do
    python -m evaluation_ifip_networking_2020.cli make_box_plot ${numerator_pickle} "request_generation/fog_app/SyntheticSeriesParallelDecomposableRequestGenerator/pseudo_random_seed"\
     "substrate_generation/substrates/SyntheticCactusSubstrateGenerator/node_count" $p --output_plot_file_name \
     "Substrate_size-to-$p" --output_path `pwd`/${folder_name} --axis_tick_rarity 1 --output_filetype pdf \
      --reduced_solutions_input_pickle_name_relative_to ${denominator_pickle} ;
    for file in ${ALIB_EXPERIMENT_HOME}/log/*; 	do mv $file ${folder_name} ; done
done